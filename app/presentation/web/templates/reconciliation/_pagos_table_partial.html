<tbody id="pagos-tbody" class="divide-y divide-[#ece7f3] dark:divide-[#382e48]">
    {% for pago in pagos %}
    <tr class="hover:bg-background-light dark:hover:bg-[#1f162e]">
        <td class="px-6 py-4 font-medium">{{ pago.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
        <td class="px-6 py-4 font-mono text-xs">{{ pago.idPago }}</td>
        <td class="px-6 py-4">
            <div class="font-bold">{{ pago.DescripClie }}</div>
            <div class="text-xs text-gray-500">{{ pago.codCliente }}</div>
        </td>
        <td class="px-6 py-4 font-bold text-primary">{{ "%.2f"|format(pago.MontoPago) }}</td>
        <td class="px-6 py-4">{{ pago.Usuario }}</td>
        <td class="px-6 py-4 text-center">
            {% if pago.status == 1 %}
                <span class="px-2 py-1 text-xs font-bold bg-yellow-100 text-yellow-700 rounded-full">Pendiente</span>
            {% elif pago.status == 3 %}
                <span class="px-2 py-1 text-xs font-bold bg-green-100 text-green-700 rounded-full">Aprobado</span>
            {% elif pago.status == 9 %}
                <span class="px-2 py-1 text-xs font-bold bg-red-100 text-red-700 rounded-full">Rechazado</span>
            {% endif %}
        </td>
        <td class="px-6 py-4 text-center">
            {% if pago.UrlImagen %}
                {% set urls = pago.UrlImagen.split(';') %}
                <div class="flex items-center justify-center gap-2">
                {% for url in urls %}
                    {% if url.strip() %}
                        <button
                            hx-get="/reconciliation/image-viewer?url={{ url.strip() }}"
                            hx-target="#modal-content"
                            hx-trigger="click"
                            onclick="document.getElementById('modal-container').classList.remove('hidden');"
                            class="p-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-md transition-colors"
                            title="Ver comprobante {{ loop.index }}">
                            <span class="material-symbols-outlined text-base">receipt_long</span>
                        </button>
                    {% endif %}
                {% endfor %}
                </div>
            {% else %}
                <span class="text-xs text-gray-400">-</span>
            {% endif %}
        </td>
        <td class="px-6 py-4 text-center">
            {% if pago.status == 1 %}
            <button 
                hx-post="/reconciliation/attempt/{{ pago.idPago }}"
                hx-target="closest tr"
                hx-swap="outerHTML"
                class="font-bold text-primary hover:underline flex items-center justify-center gap-1 mx-auto">
                <span class="material-symbols-outlined text-base htmx-indicator animate-spin">progress_activity</span>
                <span>Conciliar</span>
            </button>
            {% else %}
            <span class="text-xs text-gray-400">Procesado</span>
            {% endif %}
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="8" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
            No se encontraron pagos con los filtros seleccionados.
        </td>
    </tr>
    {% endfor %}
</tbody>
