{% extends "base.html" %}

{% block title %}Mapeo de Bancos{% endblock %}

{% block content %}
<div class="flex flex-col gap-2 mb-8">
    <div class="flex items-center gap-2 text-sm text-[#6b4c9a] dark:text-[#a589cc]">
        <a class="hover:text-primary transition-colors" href="/">Home</a>
        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
        <a class="hover:text-primary transition-colors" href="/configuracion/ajustes">Configuración</a>
        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
        <span class="font-medium text-primary uppercase text-[10px] font-black tracking-widest">Mapeo de Bancos</span>
    </div>
    <h1 class="text-3xl font-black text-[#130d1b] dark:text-white tracking-tight">Equivalencia de Bancos</h1>
    <p class="text-[#6b4c9a] dark:text-[#a589cc] mt-1 font-medium">Asocia los códigos del portal externo con las cuentas de tu ERP.</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Formulario de Registro -->
    <div class="lg:col-span-1">
        <div class="bg-white dark:bg-surface-dark p-6 rounded-2xl shadow-sm border border-[#d9cfe7] dark:border-[#382e48] sticky top-24">
            <h3 class="text-lg font-bold mb-6 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">add_link</span>
                Nuevo Mapeo
            </h3>
            
            <form action="/configuracion/bancos/mapeo" method="POST" class="space-y-4">
                <div>
                    <label class="block text-[10px] font-black text-[#6b4c9a] dark:text-[#a589cc] uppercase mb-1 tracking-tighter">Código Portal (Externo)</label>
                    <input type="text" name="portal_code" required placeholder="Ej: 04, BANPAN"
                           class="w-full bg-background-light dark:bg-[#1f162e] border border-[#d9cfe7] dark:border-[#382e48] rounded-lg px-4 py-2 font-bold focus:ring-primary">
                </div>

                <div>
                    <label class="block text-[10px] font-black text-[#6b4c9a] dark:text-[#a589cc] uppercase mb-1 tracking-tighter">Banco ERP (Interno)</label>
                    <select name="erp_code" required class="w-full bg-background-light dark:bg-[#1f162e] border border-[#d9cfe7] dark:border-[#382e48] rounded-lg px-4 py-2 font-bold text-primary focus:ring-primary">
                        <option value="">Seleccione un banco...</option>
                        {% for banco in erp_bancos %}
                            <option value="{{ banco.id }}">{{ banco.id }} - {{ banco.descripcion }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] font-black text-[#6b4c9a] dark:text-[#a589cc] uppercase mb-1 tracking-tighter">Moneda de la Cuenta</label>
                    <select name="currency" required class="w-full bg-background-light dark:bg-[#1f162e] border border-[#d9cfe7] dark:border-[#382e48] rounded-lg px-4 py-2 font-bold text-primary focus:ring-primary">
                        <option value="USD">USD - Dólares</option>
                        <option value="VES">VES - Bolívares</option>
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] font-black text-[#6b4c9a] dark:text-[#a589cc] uppercase mb-1 tracking-tighter">Descripción</label>
                    <input type="text" name="description" placeholder="Referencia opcional"
                           class="w-full bg-background-light dark:bg-[#1f162e] border border-[#d9cfe7] dark:border-[#382e48] rounded-lg px-4 py-2 text-sm">
                </div>

                <div class="flex items-center gap-3 bg-background-light dark:bg-[#1f162e] p-3 rounded-lg border border-[#d9cfe7] dark:border-[#382e48]">
                    <input type="checkbox" name="is_cash" id="is_cash" class="w-5 h-5 text-primary focus:ring-primary rounded border-gray-300">
                    <label for="is_cash" class="text-sm font-bold text-gray-700 dark:text-gray-300 select-none">
                        ¿Es cuenta de Caja/Efectivo?
                    </label>
                </div>

                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-black py-3 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 uppercase tracking-widest text-xs">
                    <span class="material-symbols-outlined text-base">save</span>
                    Guardar Mapeo
                </button>
            </form>
        </div>
    </div>

    <!-- Listado de Mapeos -->
    <div class="lg:col-span-2">
        <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-[#d9cfe7] dark:border-[#382e48] overflow-hidden">
            <table class="w-full text-left text-sm whitespace-nowrap">
                <thead class="bg-background-light dark:bg-[#1f162e] text-[#6b4c9a] dark:text-[#a589cc] font-black uppercase tracking-tighter text-[10px] border-b border-[#d9cfe7] dark:border-[#382e48]">
                    <tr>
                        <th class="px-6 py-4">Código Portal</th>
                        <th class="px-6 py-4">Equivale a ERP</th>
                        <th class="px-6 py-4 text-center">Tipo</th>
                        <th class="px-6 py-4 text-center">Moneda</th>
                        <th class="px-6 py-4">Descripción</th>
                        <th class="px-6 py-4 text-center">Acción</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-[#ece7f3] dark:divide-[#382e48]">
                    {% for m in mappings %}
                    <tr id="mapping-{{ m.id }}" class="hover:bg-background-light dark:hover:bg-[#1f162e] transition-colors">
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 bg-primary/10 text-primary rounded font-black text-xs">{{ m.portal_code }}</span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-xs text-gray-400">sync_alt</span>
                                <span class="font-bold">{{ m.erp_code }}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            {% if m.is_cash %}
                                <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-[10px] font-black uppercase">Caja</span>
                            {% else %}
                                <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full text-[10px] font-black uppercase">Banco</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="font-mono font-black text-xs">{{ m.currency }}</span>
                        </td>
                        <td class="px-6 py-4 text-xs text-gray-500">{{ m.description or '-' }}</td>
                        <td class="px-6 py-4 text-center">
                            <button hx-delete="/configuracion/bancos/mapeo/{{ m.id }}" 
                                    hx-target="#mapping-{{ m.id }}" 
                                    hx-swap="outerHTML"
                                    hx-confirm="¿Estás seguro de eliminar este mapeo?"
                                    class="text-red-500 hover:text-red-700 transition-colors">
                                <span class="material-symbols-outlined text-lg">delete</span>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-gray-400">
                            <span class="material-symbols-outlined text-4xl block mb-2">link_off</span>
                            No hay equivalencias configuradas aún.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
